<h1>VibeCodingLab 專案說明文件</h1>
<h2>專案總覽 (Project Overview)</h2>
<p><strong>VibeCodingLab</strong> 是一個互動式的 Python 程式設計學習平台（Web Application），旨在透過即時的程式碼執行與 AI 輔助評分，幫助使用者練習 Python 程式題。</p>
<ul>
<li><strong>解決的問題</strong>：提供一個安全、即時回饋的 Python 練習環境，解決傳統練習缺乏即時指導與程式碼品質分析的問題。</li>
<li><strong>使用對象</strong>：Python 初學者、程式設計學生。</li>
<li><strong>專案性質</strong>：Web Application (Frontend + Backend)。</li>
</ul>
<p>主要特色包含：
- <strong>安全沙箱執行</strong>：在後端安全地執行使用者提交的 Python 程式碼。
- <strong>AI 智慧評分</strong>：整合 Google Gemini API，針對程式碼的正確性、時間/空間複雜度、易讀性進行多維度評分。
- <strong>即時回饋</strong>：提供執行結果與 AI 建議，引導使用者優化程式碼。
- <strong>題目管理</strong>：整合 Google Sheets 作為題目與成績的後台資料庫。</p>
<p>網站連結： https://gkwang4912.github.io/VibeCodingLab/</p>
<h2>系統架構說明 (Architecture Overview)</h2>
<p>本系統採用經典的前後端分離架構。前端負責使用者介面與互動，後端負責核心邏輯、程式碼安全執行與 AI 整合。</p>
<ul>
<li><strong>Frontend</strong>: 使用原生 HTML/CSS/JavaScript 建構，整合 Monaco Editor 提供 IDE 等級的編輯體驗。</li>
<li><strong>Backend</strong>: 使用 Python Flask 框架，處理 API 請求、管理與 Google Sheets 的同步，並實作程式碼沙箱 (Sandbox)。</li>
<li><strong>AI Service</strong>: 整合 Google Gemini API 進行程式碼理解與評分。</li>
<li><strong>Database</strong>: 使用 JSON 檔案快取題目資料，並以 Google Sheets 作為持久化資料源。</li>
</ul>
<pre><code class="language-mermaid">graph TD
    User((使用者)) --&gt;|HTTPS| Frontend[&quot;Frontend (Browser)&quot;]

    subgraph &quot;Local / Server Environment&quot;
        Frontend --&gt;|API Request| Flask[&quot;Backend Server (Flask)&quot;]
        Flask --&gt;|Safe Execute| Sandbox[&quot;Python Sandbox&quot;]
        Flask --&gt;|Read/Write| Config[&quot;JSON Config &amp; Data&quot;]
    end

    subgraph &quot;External Services&quot;
        Flask --&gt;|Generate Content| Gemini[&quot;Google Gemini API&quot;]
        Flask --&gt;|Sync Data| GSheets[(&quot;Google Sheets&quot;)]
        Frontend -.-&gt;|Tunneling| Ngrok[&quot;Ngrok Tunnel&quot;]
    end

    style Frontend fill:#f9f,stroke:#333,stroke-width:2px
    style Flask fill:#bbf,stroke:#333,stroke-width:2px
    style Sandbox fill:#bfb,stroke:#333,stroke-width:2px
</code></pre>
<h2>系統流程說明 (System Flow)</h2>
<p>以下展示使用者提交程式碼進行「AI 檢查」的核心流程：</p>
<ol>
<li><strong>提交</strong>：使用者在編輯器撰寫程式碼並點擊檢查。</li>
<li><strong>驗證</strong>：後端先進行 AST (Abstract Syntax Tree) 安全性檢查，阻擋危險函數。</li>
<li><strong>執行</strong>：在限制時間與權限的環境下執行程式碼，比對輸出與預期結果。</li>
<li><strong>AI 分析</strong>：若執行正確，將程式碼傳送至 Gemini API 進行多維度評分。</li>
<li><strong>回饋</strong>：前端接收並顯示評分雷達圖與改進建議。</li>
</ol>
<pre><code class="language-mermaid">sequenceDiagram
    participant User as 使用者
    participant UI as 前端介面
    participant Server as 後端 (Flask)
    participant Sandbox as 沙箱環境
    participant AI as Gemini API

    User-&gt;&gt;UI: 撰寫程式碼並點擊 &quot;AI 檢查&quot;
    UI-&gt;&gt;Server: POST /ai-check (code, question_id)

    rect rgb(240, 240, 240)
        Note over Server: 安全性驗證 (Safety Check)
        Server-&gt;&gt;Server: AST 分析 (阻擋危險 import/exec)
    end

    alt 安全性驗證失敗
        Server--&gt;&gt;UI: 回傳 &quot;Security Error&quot;
        UI-&gt;&gt;User: 顯示禁止使用的語法警告
    else 驗證通過
        Server-&gt;&gt;Sandbox: 執行程式碼 (Execute with Timeout)
        Sandbox--&gt;&gt;Server: 回傳 執行輸出 (Output)

        alt 執行錯誤 或 答案不符
            Server--&gt;&gt;UI: 回傳 執行錯誤資訊
            UI-&gt;&gt;User: 顯示錯誤 Log
        else 答案正確
            Server-&gt;&gt;AI: 請求程式碼分析 (Code Analysis)
            AI--&gt;&gt;Server: 回傳 JSON 評分 (Score &amp; Suggestions)
            Server-&gt;&gt;Server: 紀錄成績至 Google Sheets
            Server--&gt;&gt;UI: 回傳 成功狀態 + AI 評語
            UI-&gt;&gt;User: 顯示雷達圖與建議
        end
    end
</code></pre>
<h2>資料夾結構說明 (Folder Structure)</h2>
<table>
<thead>
<tr>
<th>資料夾/檔案</th>
<th>類型</th>
<th>說明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>VibeCodingLab/</code></td>
<td>Root</td>
<td>專案根目錄</td>
</tr>
<tr>
<td>├── <code>server.py</code></td>
<td>File</td>
<td><strong>核心後端程式</strong>。負責啟動 Flask Server、處理 API、整合 Gemini 與執行 Python 程式碼。</td>
</tr>
<tr>
<td>├── <code>fetch_questions.py</code></td>
<td>File</td>
<td><strong>資料同步工具</strong>。用於從 Google Sheets 下載題目並更新至 <code>questions.json</code>。</td>
</tr>
<tr>
<td>├── <code>frontend/</code></td>
<td>Dir</td>
<td><strong>前端程式碼目錄</strong>。</td>
</tr>
<tr>
<td>│   ├── <code>index.html</code></td>
<td>File</td>
<td>網頁入口，包含主介面結構。</td>
</tr>
<tr>
<td>│   ├── <code>script.js</code></td>
<td>File</td>
<td>前端核心邏輯 (IDE 整合、API 呼叫、狀態管理)。</td>
</tr>
<tr>
<td>│   ├── <code>config.js</code></td>
<td>File</td>
<td>前端設定檔 (主要定義 API_URL)。</td>
</tr>
<tr>
<td>│   └── <code>questions-manager.js</code></td>
<td>File</td>
<td>題目管理邏輯 (渲染題目列表、切換題目)。</td>
</tr>
<tr>
<td>├── <code>api_keys.json</code></td>
<td>File</td>
<td><strong>敏感設定</strong>。儲存 Gemini API Keys 列表 (GitIgnore 建議)。</td>
</tr>
<tr>
<td>├── <code>questions.json</code></td>
<td>File</td>
<td><strong>資料快取</strong>。從 Google Sheets 同步下來的題目資料。</td>
</tr>
<tr>
<td>└── <code>verify_input_fix.py</code></td>
<td>File</td>
<td>輔助測試腳本。</td>
</tr>
</tbody>
</table>
<h2>核心模組與重要檔案 (Key Modules &amp; Files)</h2>
<h3>1. Backend (<code>server.py</code>)</h3>
<ul>
<li><strong><code>execute_code</code></strong>: 核心沙箱函數。使用 <code>exec</code> 但配合 <code>validate_code_safety</code> (AST 檢查) 與 <code>builtins</code> 白名單，確保無法執行刪除檔案、網路請求等危險操作。</li>
<li><strong><code>ai_check_code</code></strong>: 評分流程控制器。串接執行結果與 <code>get_gemini_model</code>，回傳結構化的 JSON 評分。</li>
<li><strong><code>init_gspread_client</code></strong>: 負責與 Google Sheets 建立連線，保存學生成績。</li>
</ul>
<h3>2. Frontend (<code>frontend/script.js</code>)</h3>
<ul>
<li><strong><code>monacoEditor</code></strong>: 整合 Microsoft Monaco Editor (VS Code 核心)，提供語法高亮與自動完成。</li>
<li><strong><code>aiCheck</code></strong>: 處理使用者點擊「AI 檢查」的非同步請求，並解析後端回傳的 JSON 更新 UI (包含雷達圖)。</li>
</ul>
<h3>3. Data Sync (<code>fetch_questions.py</code>)</h3>
<ul>
<li>獨立運作的腳本，透過公開的 Google Sheets CSV 匯出連結 (<code>SHEET_URL</code>) 解析並重新生成 <code>questions.json</code>。</li>
</ul>
<p>關係圖如下：</p>
<pre><code class="language-mermaid">classDiagram
    direction TB
    class Server {
        +execute_with_timeout()
        +validate_code_safety()
        +ai_analyze_code()
    }
    class Frontend {
        +updateStatsDisplay()
        +aiCheck()
        +renderProbabilityChart()
    }
    class DataHandler {
        +fetch_questions_from_sheet()
        +save_questions_to_file()
    }

    Server --&gt; Frontend : Provides API
    Frontend --&gt; Server : Consumes API
    DataHandler ..&gt; Server : Generates questions.json
    Server ..&gt; GoogleSheets : Writes Scores
</code></pre>
<h2>安裝與環境需求 (Installation &amp; Requirements)</h2>
<h3>系統需求</h3>
<ul>
<li><strong>OS</strong>: Windows / macOS / Linux</li>
<li><strong>Python</strong>: 3.8+</li>
<li><strong>Google Cloud API Access</strong>: 需具備 Gemini API Key。</li>
</ul>
<h3>相依套件 (Dependencies)</h3>
<p>請參考專案中的 import 需求，主要套件如下：
- <code>flask</code> (Web Framework)
- <code>flask-cors</code> (CORS Support)
- <code>google-generativeai</code> (Gemini AI SDK)
- <code>gspread</code> (Google Sheets API)
- <code>oauth2client</code> (Google Auth)</p>
<h3>安裝步驟</h3>
<ol>
<li>建立 Python 虛擬環境:
   <code>bash
   python -m venv venv
   source venv/bin/activate  # Windows: venv\Scripts\activate</code></li>
<li>安裝套件:
   <code>bash
   pip install flask flask-cors google-generativeai gspread oauth2client requests</code></li>
<li>設定 API Keys:
   確保 <code>api_keys.json</code> 存在且包含有效的 Gemini API Key 列表。</li>
</ol>
<h2>使用方式 (How to Use)</h2>
<h3>1. 啟動後端</h3>
<p>在專案根目錄執行：</p>
<pre><code class="language-powershell">python server.py
</code></pre>
<p>伺服器預設會在 <code>http://localhost:5000</code> 啟動。</p>
<h3>2. 啟動/開啟前端</h3>
<ul>
<li><strong>本地開發</strong>: 直接用瀏覽器開啟 <code>frontend/index.html</code>。</li>
<li><strong>遠端/手機測試</strong>: </li>
<li>使用 ngrok 對映後端: <code>ngrok http 5000</code></li>
<li>修改 <code>frontend/config.js</code> 中的 <code>API_URL</code> 為 ngrok 網址。</li>
</ul>
<h3>3. 操作流程</h3>
<ol>
<li>瀏覽器開啟頁面，左側選擇題目。</li>
<li>中間編輯區撰寫 Python 程式碼。</li>
<li>點擊 <strong>"執行程式碼"</strong> 進行單純測試 (不消耗 API Quota)。</li>
<li>點擊 <strong>"AI 檢查"</strong> 進行評分與獲取建議 (需通過正確性測試)。</li>
</ol>
<h2>設定說明 (Configuration)</h2>
<table>
<thead>
<tr>
<th>設定檔</th>
<th>關鍵參數</th>
<th>說明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>frontend/config.js</code></td>
<td><code>API_URL</code></td>
<td>指定後端 API 地址，支援 localhost 或 ngrok URL。</td>
</tr>
<tr>
<td><code>api_keys.json</code></td>
<td><code>api_keys</code></td>
<td>JSON string 陣列，存放多組 Gemini API Keys 以供輪替使用。</td>
</tr>
<tr>
<td><code>server.py</code></td>
<td><code>SCORES_SPREADSHEET_ID</code></td>
<td>設定 Google Sheets 的 ID，用於成績紀錄。</td>
</tr>
<tr>
<td><code>server.py</code></td>
<td><code>SAFE_BUILTINS</code></td>
<td>允許使用者使用的 Python 內建函數白名單。</td>
</tr>
</tbody>
</table>
<h2>開發者指南 (Developer Guide)</h2>
<ol>
<li><strong>修改題目</strong>:</li>
<li>不建議直接修改 <code>questions.json</code>。</li>
<li>
<p>請更新 Google Sheets 來源，再執行 <code>python fetch_questions.py</code> 同步最新題目。</p>
</li>
<li>
<p><strong>擴充安全性</strong>:</p>
</li>
<li>
<p>若需開放更多 Python 模組 (如 <code>math</code>, <code>random</code>)，需修改 <code>server.py</code> 中的 <code>safe_import</code> 邏輯與 <code>SAFE_BUILTINS</code> 白名單。</p>
</li>
<li>
<p><strong>前端除錯</strong>:</p>
</li>
<li>使用 Chrome DevTools Console 查看 API 回傳的錯誤訊息。</li>
<li>注意 CORS 問題，確保 <code>flask_cors</code> 設定正確。</li>
</ol>
<h2>已知限制與待辦事項 (Limitations &amp; TODO)</h2>
<h3>已知限制 (Limitations)</h3>
<ul>
<li><strong>程式碼沙箱</strong>: 目前僅透過 Python <code>exec</code> 與 AST 檢查實作軟隔離，並非 Docker 級別的強隔離，請勿在生產環境直接暴露給未受信任的公開網路。</li>
<li><strong>UI 狀態</strong>: 重新整理頁面後，未保存的程式碼可能會遺失 (Local Storage 實作依賴前端邏輯)。</li>
<li><strong>API 額度</strong>: 高頻率請求可能觸發 Gemini API Rate Limit，後端雖有 Key 輪替機制，但仍受限於配額。</li>
</ul>
<h3>待辦事項 (TODO)</h3>
<ul>
<li>[ ] 實作 Docker 容器化部署，增強沙箱安全性。</li>
<li>[ ] 增加使用者登入系統，區分不同學生的學習歷程。</li>
<li>[ ] 支援更多程式語言 (如 JavaScript, C++)。</li>
<li>[ ] 優化前端 Mobile 體驗，改進虛擬鍵盤遮擋問題。</li>
</ul>
<h2>補充說明 (Notes)</h2>
<ul>
<li>本專案為了教學便利，將部分 API Key 與設定檔保留在專案結構中 (如 <code>api_keys.json</code>)，在正式開源或部署時請務必加入 <code>.gitignore</code>。</li>
<li>後端 <code>init_gspread_client</code> 支援 Service Account 與 API Key 兩種模式，請依據部屬環境選擇。</li>
</ul>